<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Transportability Analysis with cfperformance • cfperformance</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Transportability Analysis with cfperformance">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-primary" data-bs-theme="dark" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">cfperformance</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.2.0</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/introduction.html">Introduction to cfperformance</a></li>
    <li><a class="dropdown-item" href="../articles/transportability.html">Transportability Analysis</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/boyercb/cfperformance/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Transportability Analysis with cfperformance</h1>
                        <h4 data-toc-skip class="author">Christopher
Boyer</h4>
            
            <h4 data-toc-skip class="date">2026-01-23</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/boyercb/cfperformance/blob/main/vignettes/transportability.Rmd" class="external-link"><code>vignettes/transportability.Rmd</code></a></small>
      <div class="d-none name"><code>transportability.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="overview">Overview<a class="anchor" aria-label="anchor" href="#overview"></a>
</h2>
<p>This vignette demonstrates how to use the
<strong>transportability</strong> functions in
<code>cfperformance</code> to evaluate prediction model performance when
transporting from a source population (such as a randomized controlled
trial) to a target population.</p>
<p>The methods are based on Voter et al. (2025), “Transportability of
machine learning-based counterfactual prediction models with application
to CASS,” <em>Diagnostic and Prognostic Research</em>, 9(4). <a href="https://doi.org/10.1186/s41512-025-00201-y" class="external-link">doi:10.1186/s41512-025-00201-y</a></p>
</div>
<div class="section level2">
<h2 id="when-to-use-transportability-analysis">When to Use Transportability Analysis<a class="anchor" aria-label="anchor" href="#when-to-use-transportability-analysis"></a>
</h2>
<p>Transportability analysis is appropriate when:</p>
<ol style="list-style-type: decimal">
<li>
<strong>You have a prediction model</strong> trained in one
population (e.g., an RCT)</li>
<li>
<strong>You want to evaluate performance</strong> in a different
target population</li>
<li>
<strong>Treatment is randomized</strong> in the source
population</li>
<li>
<strong>Covariates are measured</strong> in both populations</li>
</ol>
<p>Common scenarios include:</p>
<ul>
<li>Evaluating an RCT-derived risk score in a real-world patient
population</li>
<li>Assessing whether a clinical prediction rule “transports” to a new
setting</li>
<li>Understanding how model performance varies across populations</li>
</ul>
</div>
<div class="section level2">
<h2 id="the-setting">The Setting<a class="anchor" aria-label="anchor" href="#the-setting"></a>
</h2>
<p>Consider two populations:</p>
<ul>
<li>
<strong>Source (S=1)</strong>: Often an RCT where treatment
<code>A</code> is randomized</li>
<li>
<strong>Target (S=0)</strong>: The population where we want to
deploy the model</li>
</ul>
<p>We observe: - Covariates <code>X</code> in both populations -
Treatment <code>A</code> in both populations<br>
- Outcomes <code>Y</code> in the source (and possibly target) - Model
predictions <code>g(X)</code> for all individuals</p>
<p>The goal is to estimate the counterfactual prediction performance
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>E</mi><mrow><mo stretchy="true" form="prefix">[</mo><mi>L</mi><mrow><mo stretchy="true" form="prefix">(</mo><msup><mi>Y</mi><mi>a</mi></msup><mo>,</mo><mi>g</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>X</mi><mo stretchy="true" form="postfix">)</mo></mrow><mo stretchy="true" form="postfix">)</mo></mrow><mo stretchy="false" form="prefix">|</mo><mi>S</mi><mo>=</mo><mn>0</mn><mo stretchy="true" form="postfix">]</mo></mrow></mrow><annotation encoding="application/x-tex">E[L(Y^a, g(X)) | S=0]</annotation></semantics></math>
— how well would the model perform in the target population if everyone
received treatment level <code>a</code>?</p>
</div>
<div class="section level2">
<h2 id="using-the-included-example-data">Using the Included Example Data<a class="anchor" aria-label="anchor" href="#using-the-included-example-data"></a>
</h2>
<p>The package includes a simulated transportability dataset:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">transport_sim</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">transport_sim</span><span class="op">)</span></span>
<span><span class="co">#&gt;           age  biomarker smoking source treatment event risk_score</span></span>
<span><span class="co">#&gt; 1  0.61691842 -0.5700952       0      0         1     0  0.2603127</span></span>
<span><span class="co">#&gt; 2  0.04053456  0.3601832       0      1         1     1  0.2962904</span></span>
<span><span class="co">#&gt; 3  0.76704199  0.4024288       1      1         0     1  0.3855963</span></span>
<span><span class="co">#&gt; 4  1.25892520 -1.5801491       0      0         1     1  0.2253197</span></span>
<span><span class="co">#&gt; 5  0.37086452  0.1336976       0      0         0     1  0.2972428</span></span>
<span><span class="co">#&gt; 6 -0.15499910  0.5227082       0      1         0     0  0.2978064</span></span>
<span></span>
<span><span class="co"># Population sizes</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"Source (RCT) n ="</span>, <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">transport_sim</span><span class="op">$</span><span class="va">source</span> <span class="op">==</span> <span class="fl">1</span><span class="op">)</span>, <span class="st">"\n"</span><span class="op">)</span></span>
<span><span class="co">#&gt; Source (RCT) n = 802</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"Target n ="</span>, <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">transport_sim</span><span class="op">$</span><span class="va">source</span> <span class="op">==</span> <span class="fl">0</span><span class="op">)</span>, <span class="st">"\n"</span><span class="op">)</span></span>
<span><span class="co">#&gt; Target n = 698</span></span></code></pre></div>
<p>The <code>transport_sim</code> dataset contains: - <code>age</code>,
<code>biomarker</code>, <code>smoking</code>: Patient covariates -
<code>source</code>: Population indicator (1 = source/RCT, 0 = target) -
<code>treatment</code>: Binary treatment (randomized in source,
confounded in target) - <code>event</code>: Binary outcome -
<code>risk_score</code>: Predictions from a model trained in the source
population</p>
</div>
<div class="section level2">
<h2 id="transport-analysis">Transport Analysis<a class="anchor" aria-label="anchor" href="#transport-analysis"></a>
</h2>
<p>The <strong>transport analysis</strong> uses outcomes from the
source/RCT to estimate performance in the target population. This is
useful when:</p>
<ul>
<li>Outcomes are only observed in the RCT</li>
<li>You want to leverage randomization in the source</li>
</ul>
<div class="section level3">
<h3 id="transportable-mse">Transportable MSE<a class="anchor" aria-label="anchor" href="#transportable-mse"></a>
</h3>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">mse_result</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/tr_mse.html">tr_mse</a></span><span class="op">(</span></span>
<span>  predictions <span class="op">=</span> <span class="va">transport_sim</span><span class="op">$</span><span class="va">risk_score</span>,</span>
<span>  outcomes <span class="op">=</span> <span class="va">transport_sim</span><span class="op">$</span><span class="va">event</span>,</span>
<span>  treatment <span class="op">=</span> <span class="va">transport_sim</span><span class="op">$</span><span class="va">treatment</span>,</span>
<span>  source <span class="op">=</span> <span class="va">transport_sim</span><span class="op">$</span><span class="va">source</span>,</span>
<span>  covariates <span class="op">=</span> <span class="va">transport_sim</span><span class="op">[</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"age"</span>, <span class="st">"biomarker"</span>, <span class="st">"smoking"</span><span class="op">)</span><span class="op">]</span>,</span>
<span>  treatment_level <span class="op">=</span> <span class="fl">0</span>,  <span class="co"># Evaluate under no treatment</span></span>
<span>  analysis <span class="op">=</span> <span class="st">"transport"</span>,</span>
<span>  estimator <span class="op">=</span> <span class="st">"dr"</span>,</span>
<span>  se_method <span class="op">=</span> <span class="st">"none"</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">mse_result</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Transportable MSE Estimation</span></span>
<span><span class="co">#&gt; --------------------------------------------- </span></span>
<span><span class="co">#&gt; Analysis: transport </span></span>
<span><span class="co">#&gt; Estimator: dr </span></span>
<span><span class="co">#&gt; Treatment level: 0 </span></span>
<span><span class="co">#&gt; N target: 698  | N source: 802 </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Estimate: 0.2432</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Naive estimate: 0.227</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="comparing-estimators">Comparing Estimators<a class="anchor" aria-label="anchor" href="#comparing-estimators"></a>
</h3>
<p>Let’s compare all four estimators:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">estimators</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"naive"</span>, <span class="st">"om"</span>, <span class="st">"ipw"</span>, <span class="st">"dr"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">mse_estimates</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">sapply</a></span><span class="op">(</span><span class="va">estimators</span>, <span class="kw">function</span><span class="op">(</span><span class="va">est</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">result</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/tr_mse.html">tr_mse</a></span><span class="op">(</span></span>
<span>    predictions <span class="op">=</span> <span class="va">transport_sim</span><span class="op">$</span><span class="va">risk_score</span>,</span>
<span>    outcomes <span class="op">=</span> <span class="va">transport_sim</span><span class="op">$</span><span class="va">event</span>,</span>
<span>    treatment <span class="op">=</span> <span class="va">transport_sim</span><span class="op">$</span><span class="va">treatment</span>,</span>
<span>    source <span class="op">=</span> <span class="va">transport_sim</span><span class="op">$</span><span class="va">source</span>,</span>
<span>    covariates <span class="op">=</span> <span class="va">transport_sim</span><span class="op">[</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"age"</span>, <span class="st">"biomarker"</span>, <span class="st">"smoking"</span><span class="op">)</span><span class="op">]</span>,</span>
<span>    treatment_level <span class="op">=</span> <span class="fl">0</span>,</span>
<span>    analysis <span class="op">=</span> <span class="st">"transport"</span>,</span>
<span>    estimator <span class="op">=</span> <span class="va">est</span>,</span>
<span>    se_method <span class="op">=</span> <span class="st">"none"</span></span>
<span>  <span class="op">)</span></span>
<span>  <span class="va">result</span><span class="op">$</span><span class="va">estimate</span></span>
<span><span class="op">}</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span></span>
<span>  Estimator <span class="op">=</span> <span class="va">estimators</span>,</span>
<span>  MSE <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="va">mse_estimates</span>, <span class="fl">4</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt;       Estimator    MSE</span></span>
<span><span class="co">#&gt; naive     naive 0.2270</span></span>
<span><span class="co">#&gt; om           om 0.2451</span></span>
<span><span class="co">#&gt; ipw         ipw 0.2406</span></span>
<span><span class="co">#&gt; dr           dr 0.2432</span></span></code></pre></div>
<ul>
<li>
<strong>naive</strong>: Uses source data with A=0 only (ignores
population differences)</li>
<li>
<strong>om</strong> (outcome model): Models E[L|X,A,S=1] and
averages over target X</li>
<li>
<strong>ipw</strong>: Reweights source observations to match target
population</li>
<li>
<strong>dr</strong> (doubly robust): Combines outcome modeling and
IPW</li>
</ul>
</div>
<div class="section level3">
<h3 id="transportable-auc">Transportable AUC<a class="anchor" aria-label="anchor" href="#transportable-auc"></a>
</h3>
<p>For discrimination, we can estimate the transportable AUC:</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">auc_result</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/tr_auc.html">tr_auc</a></span><span class="op">(</span></span>
<span>  predictions <span class="op">=</span> <span class="va">transport_sim</span><span class="op">$</span><span class="va">risk_score</span>,</span>
<span>  outcomes <span class="op">=</span> <span class="va">transport_sim</span><span class="op">$</span><span class="va">event</span>,</span>
<span>  treatment <span class="op">=</span> <span class="va">transport_sim</span><span class="op">$</span><span class="va">treatment</span>,</span>
<span>  source <span class="op">=</span> <span class="va">transport_sim</span><span class="op">$</span><span class="va">source</span>,</span>
<span>  covariates <span class="op">=</span> <span class="va">transport_sim</span><span class="op">[</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"age"</span>, <span class="st">"biomarker"</span>, <span class="st">"smoking"</span><span class="op">)</span><span class="op">]</span>,</span>
<span>  treatment_level <span class="op">=</span> <span class="fl">0</span>,</span>
<span>  analysis <span class="op">=</span> <span class="st">"transport"</span>,</span>
<span>  estimator <span class="op">=</span> <span class="st">"dr"</span>,</span>
<span>  se_method <span class="op">=</span> <span class="st">"none"</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">auc_result</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Transportable AUC Estimation</span></span>
<span><span class="co">#&gt; --------------------------------------------- </span></span>
<span><span class="co">#&gt; Analysis: transport </span></span>
<span><span class="co">#&gt; Estimator: dr </span></span>
<span><span class="co">#&gt; Treatment level: 0 </span></span>
<span><span class="co">#&gt; N target: 698  | N source: 802 </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Estimate: 0.7021</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Naive estimate: 0.6915</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="transportable-calibration">Transportable Calibration<a class="anchor" aria-label="anchor" href="#transportable-calibration"></a>
</h3>
<p>To assess calibration in the target population:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">calib_result</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/tr_calibration.html">tr_calibration</a></span><span class="op">(</span></span>
<span>  predictions <span class="op">=</span> <span class="va">transport_sim</span><span class="op">$</span><span class="va">risk_score</span>,</span>
<span>  outcomes <span class="op">=</span> <span class="va">transport_sim</span><span class="op">$</span><span class="va">event</span>,</span>
<span>  treatment <span class="op">=</span> <span class="va">transport_sim</span><span class="op">$</span><span class="va">treatment</span>,</span>
<span>  source <span class="op">=</span> <span class="va">transport_sim</span><span class="op">$</span><span class="va">source</span>,</span>
<span>  covariates <span class="op">=</span> <span class="va">transport_sim</span><span class="op">[</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"age"</span>, <span class="st">"biomarker"</span>, <span class="st">"smoking"</span><span class="op">)</span><span class="op">]</span>,</span>
<span>  treatment_level <span class="op">=</span> <span class="fl">0</span>,</span>
<span>  analysis <span class="op">=</span> <span class="st">"transport"</span>,</span>
<span>  estimator <span class="op">=</span> <span class="st">"ipw"</span>,</span>
<span>  smoother <span class="op">=</span> <span class="st">"loess"</span>,</span>
<span>  se_method <span class="op">=</span> <span class="st">"none"</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">calib_result</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Transportable CALIBRATION Estimation</span></span>
<span><span class="co">#&gt; --------------------------------------------- </span></span>
<span><span class="co">#&gt; Analysis: transport </span></span>
<span><span class="co">#&gt; Estimator: ipw </span></span>
<span><span class="co">#&gt; Treatment level: 0 </span></span>
<span><span class="co">#&gt; N target: 698  | N source: 802 </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Calibration Metrics:</span></span>
<span><span class="co">#&gt;   ICI (Integrated Calibration Index): 0.1117 </span></span>
<span><span class="co">#&gt;   E50 (Median absolute error): 0.0956 </span></span>
<span><span class="co">#&gt;   E90 (90th percentile error): 0.2335 </span></span>
<span><span class="co">#&gt;   Emax (Maximum error): 0.2796</span></span></code></pre></div>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">calib_result</span><span class="op">)</span></span></code></pre></div>
<div class="figure">
<img src="transportability_files/figure-html/plot-calibration-1.png" class="r-plt" alt="Transportable calibration curve for the target population" width="576"><p class="caption">
Transportable calibration curve for the target population
</p>
</div>
</div>
</div>
<div class="section level2">
<h2 id="joint-analysis">Joint Analysis<a class="anchor" aria-label="anchor" href="#joint-analysis"></a>
</h2>
<p>The <strong>joint analysis</strong> pools source and target data for
potentially more efficient estimation. This requires outcome data in
both populations.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">mse_joint</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/tr_mse.html">tr_mse</a></span><span class="op">(</span></span>
<span>  predictions <span class="op">=</span> <span class="va">transport_sim</span><span class="op">$</span><span class="va">risk_score</span>,</span>
<span>  outcomes <span class="op">=</span> <span class="va">transport_sim</span><span class="op">$</span><span class="va">event</span>,</span>
<span>  treatment <span class="op">=</span> <span class="va">transport_sim</span><span class="op">$</span><span class="va">treatment</span>,</span>
<span>  source <span class="op">=</span> <span class="va">transport_sim</span><span class="op">$</span><span class="va">source</span>,</span>
<span>  covariates <span class="op">=</span> <span class="va">transport_sim</span><span class="op">[</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"age"</span>, <span class="st">"biomarker"</span>, <span class="st">"smoking"</span><span class="op">)</span><span class="op">]</span>,</span>
<span>  treatment_level <span class="op">=</span> <span class="fl">0</span>,</span>
<span>  analysis <span class="op">=</span> <span class="st">"joint"</span>,  <span class="co"># Pool data</span></span>
<span>  estimator <span class="op">=</span> <span class="st">"dr"</span>,</span>
<span>  se_method <span class="op">=</span> <span class="st">"none"</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"Transport MSE:"</span>, <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="va">mse_result</span><span class="op">$</span><span class="va">estimate</span>, <span class="fl">4</span><span class="op">)</span>, <span class="st">"\n"</span><span class="op">)</span></span>
<span><span class="co">#&gt; Transport MSE: 0.2432</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"Joint MSE:"</span>, <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="va">mse_joint</span><span class="op">$</span><span class="va">estimate</span>, <span class="fl">4</span><span class="op">)</span>, <span class="st">"\n"</span><span class="op">)</span></span>
<span><span class="co">#&gt; Joint MSE: 0.242</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="bootstrap-standard-errors">Bootstrap Standard Errors<a class="anchor" aria-label="anchor" href="#bootstrap-standard-errors"></a>
</h2>
<p>For inference, use bootstrap standard errors:</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">mse_with_se</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/tr_mse.html">tr_mse</a></span><span class="op">(</span></span>
<span>  predictions <span class="op">=</span> <span class="va">transport_sim</span><span class="op">$</span><span class="va">risk_score</span>,</span>
<span>  outcomes <span class="op">=</span> <span class="va">transport_sim</span><span class="op">$</span><span class="va">event</span>,</span>
<span>  treatment <span class="op">=</span> <span class="va">transport_sim</span><span class="op">$</span><span class="va">treatment</span>,</span>
<span>  source <span class="op">=</span> <span class="va">transport_sim</span><span class="op">$</span><span class="va">source</span>,</span>
<span>  covariates <span class="op">=</span> <span class="va">transport_sim</span><span class="op">[</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"age"</span>, <span class="st">"biomarker"</span>, <span class="st">"smoking"</span><span class="op">)</span><span class="op">]</span>,</span>
<span>  treatment_level <span class="op">=</span> <span class="fl">0</span>,</span>
<span>  analysis <span class="op">=</span> <span class="st">"transport"</span>,</span>
<span>  estimator <span class="op">=</span> <span class="st">"dr"</span>,</span>
<span>  se_method <span class="op">=</span> <span class="st">"bootstrap"</span>,</span>
<span>  n_boot <span class="op">=</span> <span class="fl">500</span>,</span>
<span>  stratified_boot <span class="op">=</span> <span class="cn">TRUE</span>  <span class="co"># Preserve source/target ratio</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">mse_with_se</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/stats/confint.html" class="external-link">confint</a></span><span class="op">(</span><span class="va">mse_with_se</span><span class="op">)</span></span></code></pre></div>
<p>The <code>stratified_boot = TRUE</code> option (default) ensures that
bootstrap samples preserve the ratio of source to target observations,
which is recommended for transportability analysis.</p>
</div>
<div class="section level2">
<h2 id="key-assumptions">Key Assumptions<a class="anchor" aria-label="anchor" href="#key-assumptions"></a>
</h2>
<p>The transportability estimators rely on several assumptions:</p>
<div class="section level3">
<h3 id="positivity-of-selection">1. Positivity of Selection<a class="anchor" aria-label="anchor" href="#positivity-of-selection"></a>
</h3>
<p><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>P</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>S</mi><mo>=</mo><mn>0</mn><mo stretchy="false" form="prefix">|</mo><mi>X</mi><mo stretchy="true" form="postfix">)</mo></mrow><mo>&gt;</mo><mn>0</mn><mrow><mspace width="0.333em"></mspace><mtext mathvariant="normal"> and </mtext><mspace width="0.333em"></mspace></mrow><mi>P</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>S</mi><mo>=</mo><mn>1</mn><mo stretchy="false" form="prefix">|</mo><mi>X</mi><mo stretchy="true" form="postfix">)</mo></mrow><mo>&gt;</mo><mn>0</mn><mrow><mspace width="0.333em"></mspace><mtext mathvariant="normal"> for all </mtext><mspace width="0.333em"></mspace></mrow><mi>X</mi></mrow><annotation encoding="application/x-tex">P(S=0|X) &gt; 0 \text{ and } P(S=1|X) &gt; 0 \text{ for all } X</annotation></semantics></math></p>
<p>Both populations must have positive probability for all covariate
values.</p>
</div>
<div class="section level3">
<h3 id="positivity-of-treatment">2. Positivity of Treatment<a class="anchor" aria-label="anchor" href="#positivity-of-treatment"></a>
</h3>
<p><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>P</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>A</mi><mo>=</mo><mi>a</mi><mo stretchy="false" form="prefix">|</mo><mi>X</mi><mo>,</mo><mi>S</mi><mo>=</mo><mn>1</mn><mo stretchy="true" form="postfix">)</mo></mrow><mo>&gt;</mo><mn>0</mn><mrow><mspace width="0.333em"></mspace><mtext mathvariant="normal"> for the treatment level of interest</mtext></mrow></mrow><annotation encoding="application/x-tex">P(A=a|X, S=1) &gt; 0 \text{ for the treatment level of interest}</annotation></semantics></math></p>
<p>In the source population, the treatment level must have positive
probability.</p>
</div>
<div class="section level3">
<h3 id="conditional-exchangeability-transportability">3. Conditional Exchangeability (Transportability)<a class="anchor" aria-label="anchor" href="#conditional-exchangeability-transportability"></a>
</h3>
<p><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mrow><mo stretchy="true" form="prefix">(</mo><msup><mi>Y</mi><mi>a</mi></msup><mo>⊥</mo><mi>S</mi><mo stretchy="true" form="postfix">)</mo></mrow><mo stretchy="false" form="prefix">|</mo><mi>X</mi></mrow><annotation encoding="application/x-tex">(Y^a \perp S) | X</annotation></semantics></math></p>
<p>The potential outcome is independent of population membership given
covariates. This means the source population is “representative” of how
the outcome model would perform in the target, after conditioning on
X.</p>
</div>
<div class="section level3">
<h3 id="consistency">4. Consistency<a class="anchor" aria-label="anchor" href="#consistency"></a>
</h3>
<p><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>Y</mi><mo>=</mo><msup><mi>Y</mi><mi>A</mi></msup></mrow><annotation encoding="application/x-tex">Y = Y^A</annotation></semantics></math></p>
<p>The observed outcome equals the potential outcome under the received
treatment.</p>
</div>
</div>
<div class="section level2">
<h2 id="when-to-use-each-function">When to Use Each Function<a class="anchor" aria-label="anchor" href="#when-to-use-each-function"></a>
</h2>
<table class="table">
<colgroup>
<col width="33%">
<col width="33%">
<col width="33%">
</colgroup>
<thead><tr class="header">
<th>Scenario</th>
<th>Function</th>
<th>Analysis</th>
</tr></thead>
<tbody>
<tr class="odd">
<td>Single population, observational data</td>
<td>
<code><a href="../reference/cf_mse.html">cf_mse()</a></code>, <code><a href="../reference/cf_auc.html">cf_auc()</a></code>,
<code><a href="../reference/cf_calibration.html">cf_calibration()</a></code>
</td>
<td>-</td>
</tr>
<tr class="even">
<td>Source (RCT) to target, outcomes in source only</td>
<td>
<code><a href="../reference/tr_mse.html">tr_mse()</a></code>, <code><a href="../reference/tr_auc.html">tr_auc()</a></code>,
<code><a href="../reference/tr_calibration.html">tr_calibration()</a></code>
</td>
<td><code>"transport"</code></td>
</tr>
<tr class="odd">
<td>Source + target, outcomes in both</td>
<td>
<code><a href="../reference/tr_mse.html">tr_mse()</a></code>, <code><a href="../reference/tr_auc.html">tr_auc()</a></code>,
<code><a href="../reference/tr_calibration.html">tr_calibration()</a></code>
</td>
<td><code>"joint"</code></td>
</tr>
</tbody>
</table>
</div>
<div class="section level2">
<h2 id="comparison-with-cf_-functions">Comparison with cf_* Functions<a class="anchor" aria-label="anchor" href="#comparison-with-cf_-functions"></a>
</h2>
<p>The <code>cf_*</code> functions (counterfactual) are for
single-population analysis:</p>
<ul>
<li>Use observational data from one population</li>
<li>Adjust for confounding between treatment and outcome</li>
<li>Equivalent to “Observational (OBS)” estimators in Voter et al.</li>
</ul>
<p>The <code>tr_*</code> functions (transportability) are for
two-population analysis:</p>
<ul>
<li>Transport from source to target population</li>
<li>Leverage randomization in source (if RCT)</li>
<li>Adjust for differences in covariate distributions</li>
</ul>
</div>
<div class="section level2">
<h2 id="references">References<a class="anchor" aria-label="anchor" href="#references"></a>
</h2>
<p>Voter, S. R., et al. (2025). “Transportability of machine
learning-based counterfactual prediction models with application to
CASS.” <em>Diagnostic and Prognostic Research</em>, 9(4). <a href="https://doi.org/10.1186/s41512-025-00201-y" class="external-link">doi:10.1186/s41512-025-00201-y</a></p>
<p>Boyer, C. B., Dahabreh, I. J., &amp; Steingrimsson, J. A. (2025).
“Estimating and evaluating counterfactual prediction models.”
<em>Statistics in Medicine</em>, 44(23-24), e70287. <a href="https://doi.org/10.1002/sim.70287" class="external-link">doi:10.1002/sim.70287</a></p>
<p>Dahabreh, I. J., Robertson, S. E., Tchetgen, E. J., Stuart, E. A.,
&amp; Hernán, M. A. (2019). “Generalizing causal inferences from
randomized trials: counterfactual and graphical identification.”
<em>Biometrics</em>, 75(2), 685-694.</p>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by <a href="https://github.com/boyercb" class="external-link">Christopher Boyer</a>, <a href="https://www.hsph.harvard.edu/issa-dahabreh/" class="external-link">Issa Dahabreh</a>, <a href="https://vivo.brown.edu/display/jsteingr" class="external-link">Jon Steingrimsson</a>.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.2.0.</p>
</div>

    </footer>
</div>





  </body>
</html>
