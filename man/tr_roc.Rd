% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/roc.R
\name{tr_roc}
\alias{tr_roc}
\title{Compute Transportable ROC Curve}
\usage{
tr_roc(
  predictions,
  outcomes,
  treatment,
  source,
  covariates,
  treatment_level = 0,
  analysis = c("transport", "joint"),
  estimator = c("dr", "om", "ipw", "naive"),
  selection_model = NULL,
  propensity_model = NULL,
  outcome_model = NULL,
  n_thresholds = 201,
  thresholds = NULL,
  include_naive = TRUE,
  ...
)
}
\arguments{
\item{predictions}{Numeric vector of model predictions.}

\item{outcomes}{Numeric vector of observed outcomes.}

\item{treatment}{Numeric vector of treatment indicators (0/1).}

\item{source}{Numeric vector of population indicators (1=source/RCT, 0=target).}

\item{covariates}{A matrix or data frame of baseline covariates.}

\item{treatment_level}{The treatment level of interest (default: 0).}

\item{analysis}{Character string specifying the type of analysis:
\itemize{
\item \code{"transport"}: Use source outcomes for target estimation (default)
\item \code{"joint"}: Pool source and target data
}}

\item{estimator}{Character string specifying the estimator:
\itemize{
\item \code{"naive"}: Naive estimator (biased)
\item \code{"om"}: Outcome model estimator
\item \code{"ipw"}: Inverse probability weighting estimator
\item \code{"dr"}: Doubly robust estimator (default)
}}

\item{selection_model}{Optional fitted selection model for P(S=0|X). If NULL,
a logistic regression model is fit using the covariates.}

\item{propensity_model}{Optional fitted propensity score model for P(A=1|X,S=1).
If NULL, a logistic regression model is fit using source data.}

\item{outcome_model}{Optional fitted outcome model for E[L(Y,g)|X,A,S].
If NULL, a regression model is fit using the relevant data.}

\item{n_thresholds}{Integer specifying the number of thresholds to evaluate.
Thresholds are evenly spaced between 0 and 1. Default is 201.}

\item{thresholds}{Optional numeric vector of specific thresholds to use.
If provided, overrides \code{n_thresholds}.}

\item{include_naive}{Logical indicating whether to also compute the naive
ROC curve for comparison. Default is TRUE.}

\item{...}{Additional arguments passed to internal functions.}
}
\value{
An object of class \code{c("tr_roc", "roc_curve")} containing:
\item{thresholds}{Thresholds used}
\item{sensitivity}{Sensitivity (TPR) at each threshold}
\item{fpr}{False positive rate at each threshold}
\item{specificity}{Specificity at each threshold}
\item{naive_sensitivity}{Naive sensitivity (if include_naive=TRUE)}
\item{naive_fpr}{Naive FPR (if include_naive=TRUE)}
\item{auc}{Area under the ROC curve (computed via trapezoidal rule)}
\item{naive_auc}{Naive AUC (if include_naive=TRUE)}
\item{estimator}{Estimator used}
\item{analysis}{Analysis type}
\item{n_source}{Number of source observations}
\item{n_target}{Number of target observations}
}
\description{
Computes a receiver operating characteristic (ROC) curve in a target
population using data transported from a source population. Returns
sensitivity (TPR) and false positive rate (FPR) at multiple thresholds.
}
\details{
The ROC curve plots sensitivity (true positive rate) against the false
positive rate (1 - specificity) at various classification thresholds.

This function computes transportable sensitivity and FPR at multiple
thresholds using the estimators from \code{\link[=tr_sensitivity]{tr_sensitivity()}} and \code{\link[=tr_fpr]{tr_fpr()}}.
The area under the curve (AUC) is computed using the trapezoidal rule on
the discrete threshold grid. For exact AUC estimation, use \code{\link[=tr_auc]{tr_auc()}}
which employs the Wilcoxon-Mann-Whitney statistic.

For efficient computation, all thresholds are evaluated in a single pass
through the data, with nuisance models fitted only once.
}
\examples{
# Generate example data
set.seed(123)
n <- 500
x <- rnorm(n)
s <- rbinom(n, 1, plogis(0.5 - 0.3 * x))
a <- ifelse(s == 1, rbinom(n, 1, 0.5), rbinom(n, 1, plogis(-0.5 + 0.5 * x)))
y <- rbinom(n, 1, plogis(-1 + x - 0.5 * a))
pred <- plogis(-1 + 0.8 * x)

# Compute transportable ROC curve
roc <- tr_roc(
  predictions = pred,
  outcomes = y,
  treatment = a,
  source = s,
  covariates = data.frame(x = x),
  n_thresholds = 51
)
print(roc)

# Plot the ROC curve
plot(roc)
}
\references{
Steingrimsson, J. A., Wen, L., Voter, S., & Dahabreh, I. J. (2024).
"Interpretable meta-analysis of model or marker performance."
\emph{arXiv preprint arXiv:2409.13458}.
}
\seealso{
\code{\link[=tr_sensitivity]{tr_sensitivity()}}, \code{\link[=tr_specificity]{tr_specificity()}}, \code{\link[=tr_fpr]{tr_fpr()}}, \code{\link[=plot.tr_roc]{plot.tr_roc()}}, \code{\link[=tr_auc]{tr_auc()}}
}
