% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/cf_auc.R
\name{cf_auc}
\alias{cf_auc}
\title{Estimate Counterfactual Area Under the ROC Curve}
\usage{
cf_auc(
  predictions,
  outcomes,
  treatment,
  covariates,
  treatment_level = 0,
  estimator = c("dr", "cl", "ipw", "naive"),
  propensity_model = NULL,
  outcome_model = NULL,
  se_method = c("bootstrap", "influence", "none"),
  n_boot = 500,
  conf_level = 0.95,
  cross_fit = FALSE,
  n_folds = 5,
  parallel = FALSE,
  ncores = NULL,
  ps_trim = NULL,
  ...
)
}
\arguments{
\item{predictions}{Numeric vector of model predictions.}

\item{outcomes}{Numeric vector of observed outcomes.}

\item{treatment}{Numeric vector of treatment indicators (0/1).}

\item{covariates}{A matrix or data frame of baseline covariates (confounders).}

\item{treatment_level}{The counterfactual treatment level (default: 0).}

\item{estimator}{Character string specifying the estimator:
\itemize{
\item \code{"naive"}: Naive estimator (biased)
\item \code{"cl"}: Conditional loss estimator
\item \code{"ipw"}: Inverse probability weighting estimator
\item \code{"dr"}: Doubly robust estimator (default)
}}

\item{propensity_model}{Optional fitted propensity score model. If NULL,
a logistic regression model is fit using the covariates.}

\item{outcome_model}{Optional fitted outcome model. If NULL, a regression
model is fit using the covariates among treated/untreated. For binary
outcomes, this should be a model for E[Y|X,A] (binomial family). For
continuous outcomes, this should be a model for E[L|X,A] (gaussian family).}

\item{se_method}{Method for standard error estimation:
\itemize{
\item \code{"bootstrap"}: Bootstrap standard errors (default)
\item \code{"influence"}: Influence function-based standard errors
\item \code{"none"}: No standard error estimation
}}

\item{n_boot}{Number of bootstrap replications (default: 500).}

\item{conf_level}{Confidence level for intervals (default: 0.95).}

\item{cross_fit}{Logical indicating whether to use cross-fitting for
nuisance model estimation (default: FALSE). Cross-fitting enables
valid inference when using flexible machine learning estimators.}

\item{n_folds}{Number of folds for cross-fitting (default: 5).}

\item{parallel}{Logical indicating whether to use parallel processing
for bootstrap (default: FALSE).}

\item{ncores}{Number of cores for parallel processing (default: NULL,
which uses all available cores minus one).}

\item{ps_trim}{Propensity score trimming specification. Controls how
extreme propensity scores are handled. Can be:
\itemize{
\item \code{NULL} (default): Uses absolute bounds \code{c(0.01, 0.99)}
\item \code{"none"}: No trimming applied
\item \code{"quantile"}: Quantile-based trimming with default \code{c(0.01, 0.99)}
\item \code{"absolute"}: Explicit absolute bounds with default \code{c(0.01, 0.99)}
\item A numeric vector of length 2: \code{c(lower, upper)} absolute bounds
\item A single numeric: Symmetric bounds \code{c(x, 1-x)}
\item A list with \code{method} ("absolute"/"quantile"/"none") and \code{bounds}
}}

\item{...}{Additional arguments passed to internal functions.}
}
\value{
An object of class \code{c("cf_auc", "cf_performance")} containing:
\item{estimate}{Point estimate of counterfactual AUC}
\item{se}{Standard error (if computed)}
\item{ci_lower}{Lower confidence interval bound}
\item{ci_upper}{Upper confidence interval bound}
\item{estimator}{Estimator used}
\item{naive_estimate}{Naive AUC for comparison}
\item{n_obs}{Number of observations}
\item{treatment_level}{Counterfactual treatment level}
}
\description{
Estimates the area under the receiver operating characteristic curve (AUC)
of a prediction model under a hypothetical intervention where treatment is
set to a specific level.
}
\details{
The counterfactual AUC is defined as the probability that a randomly
selected individual with the outcome under the counterfactual intervention
has a higher predicted risk than a randomly selected individual without
the outcome.

The function implements three estimators:

\strong{Outcome Model (OM/CL) Estimator}: Weights concordant pairs by the
predicted probability of case/non-case status under the counterfactual.

\strong{IPW Estimator}: Weights concordant pairs by the inverse probability
of treatment.

\strong{Doubly Robust (DR) Estimator}: Combines OM and IPW for double robustness.
When \code{cross_fit = TRUE}, uses cross-fitting for valid inference with flexible
ML methods (see \code{\link[=ml_learner]{ml_learner()}}).
}
\examples{
# Generate example data
set.seed(123)
n <- 500
x <- rnorm(n)
a <- rbinom(n, 1, plogis(-0.5 + 0.5 * x))
y <- rbinom(n, 1, plogis(-1 + x - 0.5 * a))
pred <- plogis(-1 + 0.8 * x)

# Estimate counterfactual AUC under no treatment
result <- cf_auc(
  predictions = pred,
  outcomes = y,
  treatment = a,
  covariates = data.frame(x = x),
  treatment_level = 0,
  estimator = "dr",
  se_method = "none"
)
print(result)
}
\references{
Boyer, C. B., Dahabreh, I. J., & Steingrimsson, J. A. (2025).
"Estimating and evaluating counterfactual prediction models."
\emph{Statistics in Medicine}, 44(23-24), e70287. \doi{10.1002/sim.70287}

Li, B., Gatsonis, C., Dahabreh, I. J., & Steingrimsson, J. A. (2022).
"Estimating the area under the ROC curve when transporting a prediction
model to a target population." \emph{Biometrics}, 79(3), 2343-2356.
\doi{10.1111/biom.13796}
}
\seealso{
\code{\link[=cf_mse]{cf_mse()}}, \code{\link[=cf_calibration]{cf_calibration()}}, \code{\link[=ml_learner]{ml_learner()}}
}
